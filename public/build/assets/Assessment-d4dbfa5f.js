import{r as d,q as A,W as T,s as u,j as l,a as n}from"./app-335dc200.js";import{A as B}from"./AdminSection-3697a379.js";import{M as J}from"./MemberLayout-aa59fa76.js";import P from"./TitleSection-ba36ba7e.js";import{P as g}from"./PrimaryButton-be95355a.js";import{l as E}from"./lodash-f8a39a45.js";import{u as H}from"./useTranslation-6210b1df.js";import"./index-250aae62.js";import"./id-410e5203.js";import"./react-responsive-ea9e328e.js";function Z({assessments:x,session:p,answers:S}){const[m,$]=d.useState(0),[w,N]=d.useState(!1),{t:f,i18n:D}=H(),{ziggy:a}=A().props,{data:y,setData:b,post:k,processing:j,errors:I}=T(),o=D.language;d.useEffect(()=>{var e;(e=member==null?void 0:member.status)!=null&&e.includes("active")||u.visit(route("member.dashboard"))},[member]);const C=e=>{e.preventDefault(),k(route("member.assessment.save"),{onSuccess:()=>{x.length>m+1?(u.visit(route("member.assessment.start",[p.id,{question:m+1}])),b({})):u.post(route("member.assessment.complete",p.id)),N(!1)}})},L=e=>{e.preventDefault(),k(route("member.assessment.save"),{onSuccess:()=>{window.scrollTo(0,0),b({}),N(!0)}})};d.useEffect(()=>{var e,r;(e=a==null?void 0:a.query)!=null&&e.question&&$(parseInt((r=a==null?void 0:a.query)==null?void 0:r.question))},[a==null?void 0:a.query]),d.useEffect(()=>{const e=r=>{r.preventDefault()};return document.body.addEventListener("cut",e),document.body.addEventListener("copy",e),()=>{document.body.removeEventListener("cut",e),document.body.removeEventListener("copy",e)}},[]);const M=e=>{e.preventDefault()},O=e=>{e.preventDefault()};d.useEffect(()=>{var r;let e=localStorage.getItem("assessment");e&&(e=JSON.parse(e)),E.isEmpty(e)?S.forEach(t=>{t.assessment_question.type==="checkbox"?_(t.assessment_question_id,t.assessment_option_id):v(t.assessment_question_id,t.assessment_option_id)}):(r=Object.keys(e))==null||r.forEach(t=>{const i=e[t],s=t.split(".");s[0]==="checkbox"?i.forEach(c=>{_(s[1],c,!0)}):s[0]==="radio"&&v(s[1],i,!0)})},[S]);const v=(e,r,t)=>{var s;const i={[`radio.${e}`]:r,assessment_id:x[((s=a==null?void 0:a.query)==null?void 0:s.question)||0].id,session_id:p.id};b(c=>{const h={...c,...i};return t||localStorage.setItem("assessment",JSON.stringify(h)),h})},_=(e,r,t)=>{b(i=>{const s=i[`checkbox.${e}`]||[],c=s.includes(r)?{...i,[`checkbox.${e}`]:s.filter(h=>h!==r)}:{...i,[`checkbox.${e}`]:[...s,r]};return t||localStorage.setItem("assessment",JSON.stringify(c)),c})},q=()=>{m>0?u.visit(route("member.assessment.start",[p.id,{question:m-1}])):u.visit(route("member.assessment.index"))};return l(J,{children:[w&&n("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-xl mb-4 relative",children:f("data_saved")}),l(B,{children:[n(P,{title:"assessment",className:"mb-6"}),n("div",{className:"assessments",onMouseDown:M,onSelectStart:O,style:{userSelect:"none"},children:x.map((e,r)=>l("form",{onSubmit:C,className:`${m===r?"":"hidden"}`,children:[n("div",{className:"mb-4 flex justify-center",children:n("img",{src:`/storage/assessments/${o==="en"&&e.image_en?e.image_en:e.image}`,alt:""})}),n("div",{className:"font-bold mb-3 text-xl text-center",children:o==="en"&&e.title_en?e.title_en:e.title}),e.description!=="<p>-</p>"&&n("div",{dangerouslySetInnerHTML:{__html:o==="en"&&e.description_en?e.description_en:e.description},className:"text-center mb-10"}),e.assessment_question.map((t,i)=>l("div",{children:[n("div",{className:"font-bold text-lg mb-3",children:o==="en"&&t.title_en?t.title_en:t.title}),n("div",{dangerouslySetInnerHTML:{__html:o==="en"&&t.question_en?t.question_en:t.question}}),n("div",{className:"mt-4",children:E.sortBy(t.assessment_option,["option_no"]).map(s=>l("div",{className:"flex items-center px-5 py-3 mb-4 rounded-3xl bg-lightPrimary bg-opacity-60",children:[t.type==="radio"?n("input",{type:"radio",name:`radio.${t.id}`,id:`option_${s.id}`,value:s.id,className:"mr-3 text-primary focus:ring-primary",checked:y[`radio.${t.id}`]===s.id,required:!0,onChange:()=>v(t.id,s.id)}):n("input",{type:"checkbox",name:`checkbox.${t.id}`,id:`option_${s.id}`,value:s.id,checked:y[`checkbox.${t.id}`]&&y[`checkbox.${t.id}`].includes(s.id),className:"mr-3 text-primary focus:ring-primary",onChange:()=>_(t.id,s.id)}),n("label",{htmlFor:`option_${s.id}`,className:"w-full",children:o==="en"&&s.option_en?s.option_en:s.option})]}))}),i+1!==e.assessment_question.length&&n("div",{className:"h-0.5 w-1/2 my-10 box-border left-1/2 mx-auto -translate-y-1/2 bg-gray-300"})]})),l("div",{className:"flex justify-center gap-6 mt-6",children:[n(g,{type:"button",onClick:q,className:"min-w-[160px] flex justify-center",color:"gray",children:f("back")}),n(g,{type:"button",onClick:L,className:"min-w-[160px] flex justify-center",color:"secondary",children:f("save")}),n(g,{type:"submit",disabled:j,className:"min-w-[160px] flex justify-center",children:f("next")})]})]}))})]})]})}export{Z as default};
