import{r as m,q as A,W as T,j as l,b as n,t as x}from"./app-13d8cc7b.js";import{A as B}from"./id-8ad1d8aa.js";import{M as J}from"./MemberLayout-94cb2785.js";import P from"./TitleSection-1ff2ea8c.js";import{P as g}from"./PrimaryButton-92f27e01.js";import{l as $}from"./lodash-4e54c85c.js";import{u as H}from"./useTranslation-e6f9aaa7.js";import"./index-05653db5.js";import"./react-responsive-97b28566.js";function Y({assessments:y,session:u,answers:S}){const[d,E]=m.useState(0),[w,N]=m.useState(!1),{t:p,i18n:D}=H(),{ziggy:a}=A().props,{data:f,setData:h,post:k,processing:j,errors:I}=T(),i=D.language,C=e=>{e.preventDefault(),k(route("member.assessment.save"),{onSuccess:()=>{y.length>d+1?(x.visit(route("member.assessment.start",[u.id,{question:d+1}])),h({})):x.post(route("member.assessment.complete",u.id)),N(!1)}})},L=e=>{e.preventDefault(),k(route("member.assessment.save"),{onSuccess:()=>{window.scrollTo(0,0),h({}),N(!0)}})};m.useEffect(()=>{var e,r;(e=a==null?void 0:a.query)!=null&&e.question&&E(parseInt((r=a==null?void 0:a.query)==null?void 0:r.question))},[a==null?void 0:a.query]),m.useEffect(()=>{const e=r=>{r.preventDefault()};return document.body.addEventListener("cut",e),document.body.addEventListener("copy",e),()=>{document.body.removeEventListener("cut",e),document.body.removeEventListener("copy",e)}},[]);const M=e=>{e.preventDefault()},O=e=>{e.preventDefault()};console.log(f),m.useEffect(()=>{var r;let e=localStorage.getItem("assessment");debugger;e&&(e=JSON.parse(e)),$.isEmpty(e)?S.forEach(t=>{t.assessment_question.type==="checkbox"?_(t.assessment_question_id,t.assessment_option_id):v(t.assessment_question_id,t.assessment_option_id)}):(r=Object.keys(e))==null||r.forEach(t=>{const o=e[t],s=t.split(".");s[0]==="checkbox"?o.forEach(c=>{_(s[1],c,!0)}):s[0]==="radio"&&v(s[1],o,!0)})},[S]);const v=(e,r,t)=>{var s;const o={[`radio.${e}`]:r,assessment_id:y[((s=a==null?void 0:a.query)==null?void 0:s.question)||0].id,session_id:u.id};h(c=>{const b={...c,...o};return t||localStorage.setItem("assessment",JSON.stringify(b)),b})},_=(e,r,t)=>{h(o=>{const s=o[`checkbox.${e}`]||[],c=s.includes(r)?{...o,[`checkbox.${e}`]:s.filter(b=>b!==r)}:{...o,[`checkbox.${e}`]:[...s,r]};return t||localStorage.setItem("assessment",JSON.stringify(c)),c})},q=()=>{d>0?x.visit(route("member.assessment.start",[u.id,{question:d-1}])):x.visit(route("member.assessment.index"))};return l(J,{children:[w&&n("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-xl mb-4 relative",children:p("data_saved")}),l(B,{children:[n(P,{title:"assessment",className:"mb-6"}),n("div",{className:"assessments",onMouseDown:M,onSelectStart:O,style:{userSelect:"none"},children:y.map((e,r)=>l("form",{onSubmit:C,className:`${d===r?"":"hidden"}`,children:[n("div",{className:"mb-4 flex justify-center",children:n("img",{src:`/storage/assessments/${i==="en"&&e.image_en?e.image_en:e.image}`,alt:""})}),n("div",{className:"font-bold mb-3 text-xl text-center",children:i==="en"&&e.title_en?e.title_en:e.title}),e.description!=="<p>-</p>"&&n("div",{dangerouslySetInnerHTML:{__html:i==="en"&&e.description_en?e.description_en:e.description},className:"text-center mb-10"}),e.assessment_question.map((t,o)=>l("div",{children:[n("div",{className:"font-bold text-lg mb-3",children:i==="en"&&t.title_en?t.title_en:t.title}),n("div",{dangerouslySetInnerHTML:{__html:i==="en"&&t.question_en?t.question_en:t.question}}),n("div",{className:"mt-4",children:$.sortBy(t.assessment_option,["option_no"]).map(s=>l("div",{className:"flex items-center px-5 py-3 mb-4 rounded-3xl bg-lightPrimary bg-opacity-60",children:[t.type==="radio"?n("input",{type:"radio",name:`radio.${t.id}`,id:`option_${s.id}`,value:s.id,className:"mr-3 text-primary focus:ring-primary",checked:f[`radio.${t.id}`]===s.id,required:!0,onChange:()=>v(t.id,s.id)}):n("input",{type:"checkbox",name:`checkbox.${t.id}`,id:`option_${s.id}`,value:s.id,checked:f[`checkbox.${t.id}`]&&f[`checkbox.${t.id}`].includes(s.id),className:"mr-3 text-primary focus:ring-primary",onChange:()=>_(t.id,s.id)}),n("label",{htmlFor:`option_${s.id}`,className:"w-full",children:i==="en"&&s.option_en?s.option_en:s.option})]}))}),o+1!==e.assessment_question.length&&n("div",{className:"h-0.5 w-1/2 my-10 box-border left-1/2 mx-auto -translate-y-1/2 bg-gray-300"})]})),l("div",{className:"flex justify-center gap-6 mt-6",children:[n(g,{type:"button",onClick:q,className:"min-w-[160px] flex justify-center",color:"gray",children:p("back")}),n(g,{type:"button",onClick:L,className:"min-w-[160px] flex justify-center",color:"secondary",children:p("save")}),n(g,{type:"submit",disabled:j,className:"min-w-[160px] flex justify-center",children:p("next")})]})]}))})]})]})}export{Y as default};
